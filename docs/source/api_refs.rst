请求类型参考
====================================

本章节列出了所有目前支持的客户端请求类型，并介绍了其格式规范。

您可以在任何您觉得合适的时候检查这里的内容，或许会对您的开发工作有所帮助。


用户鉴权标头
------------------------

对于大多数在下文即将提到的请求而言（通常而言，这即指除了 login 和 disconnect 
的其他所有请求），都需要一个包含用户授权信息的标头来帮助服务器识别和验证用户操
作的合法性。

它在作为通常的信息传输载体的 json 文本中应处于如下位置：

.. code-block:: json
    
    {
        "auth": {
            "username": "",
            "token": ""
        }
    }

下表以 json 的术语组织了表格结构。

.. list-table:: auth 标头
    :widths: 15 10 30
    :header-rows: 1

    * - 键名
      - 类型
      - 描述
    * - username
      - TEXT
      - 该名称对应的值记录请求用户的用户名。
    * - token
      - TEXT
      - 记录用户的 token。在验证时，服务器将检查 token 是否仍然有效，
        并确认 username 与 token 是否相对应；不过，目前仍然可以通过解析 
        token 来获知用户名（未来可能会对 token 进行加密）。


请求类型一览
--------------------

以下介绍了所有目前支持的请求类型。

request::login
^^^^^^^^^^^^^^^^^^^^^

该请求执行与用户登录相关的操作。它需要 data 键下的一些数据作为必要的信息；
它不需要 auth 标头即可使用。

.. list-table:: data 标头
    :widths: 15 10 30
    :header-rows: 1

    * - 键名
      - 类型
      - 描述
    * - username
      - TEXT
      - 该名称对应的值记录请求用户的用户名。
    * - password
      - TEXT
      - 记录用户的密码。根据服务端的逻辑，该密码将在到达服务器后与 salt
        再次执行一次运算；它实际上是用户使用的“可读性密码”经过不可逆运算
        后得到的结果，也就是说，对用户密码的验证实际上是对这一运算后结果
        的验证，而非对原始的“可读性密码”的验证。

服务端响应：

.. list-table:: 响应结构
    :widths: 15 10 30
    :header-rows: 1

    * - 键名
      - 类型
      - 描述
    * - code
      - INTEGER
      - 对应的键值为本次请求返回的状态码。
    * - msg
      - TEXT
      - 响应所返回的较为简短的信息描述。这并不是所有服务端必须支持的。
    * - token
      - TEXT
      - 记录登录成功后服务端生成给客户端的用户令牌。该令牌默认将在3600
        秒后过期。如果登录没有成功，则可能不会附带此键。

如果登录失败，则服务端可能根据其策略延迟响应时间。这一策略的默认值通常为 3 秒。

在本请求中可能出现的返回码：

.. list-table:: 返回码列表
    :widths: 15 10 30
    :header-rows: 1

    * - 返回码
      - 含义
      - 解释
    * - 0
      - 登录正常完成。
      - 
    * - -1
      - 缺少必要的数据结构。
      - 未附带 data 键。
    * - -2
      - data 键确已提供，但并未提供所需的用户名和密码。
      - 
    * - 401
      - 由于凭据无效，请求被拒绝。
      - 用户名或与密码不匹配。
